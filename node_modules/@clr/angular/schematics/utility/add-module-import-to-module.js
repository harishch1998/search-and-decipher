"use strict";
/*
 * Copyright (c) 2016-2021 VMware, Inc. All Rights Reserved.
 * This software is released under MIT license.
 * The full license information can be found in LICENSE in the root directory of this project.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.addModuleImportToModule = void 0;
const schematics_1 = require("@angular-devkit/schematics");
const change_1 = require("@schematics/angular/utility/change");
const ast_utils_1 = require("@schematics/angular/utility/ast-utils");
const get_typescript_source_file_1 = require("./get-typescript-source-file");
/**
 * Import and add module to specific module path.
 * @param host {Tree} The source tree.
 * @param importedModuleName {String} The name of the imported module.
 * @param importedModulePath {String} The location of the imported module.
 * @param moduleToImportIn {String} The location of the module to import in.
 */
function addModuleImportToModule(host, importedModuleName, importedModulePath, moduleToImportIn) {
    if (!moduleToImportIn) {
        throw new schematics_1.SchematicsException(`Entry module not found.`);
    }
    const moduleSource = get_typescript_source_file_1.getTypeScriptSourceFile(host, moduleToImportIn);
    if (!moduleSource) {
        throw new schematics_1.SchematicsException(`Module not found: ${moduleToImportIn}`);
    }
    const changes = ast_utils_1.addImportToModule(moduleSource, moduleToImportIn, importedModuleName, importedModulePath);
    const recorder = host.beginUpdate(moduleToImportIn);
    changes
        .filter((change) => change instanceof change_1.InsertChange)
        .forEach((change) => recorder.insertLeft(change.pos, change.toAdd));
    host.commitUpdate(recorder);
}
exports.addModuleImportToModule = addModuleImportToModule;
//# sourceMappingURL=add-module-import-to-module.js.map